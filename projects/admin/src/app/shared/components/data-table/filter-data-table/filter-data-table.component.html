<button mat-fab color="primary" (click)="addFilter()">
  <mat-icon>add</mat-icon>
</button>
<!-- @for (filter of fitlers.controls; track filter; let idx = $index) { -->
<ng-container *ngFor="let filter of filters.controls; let idx = index">
  <div [formGroup]="filter">
    <mat-form-field>
      <mat-label>field</mat-label>
      <mat-select [formControl]="filter.controls.field" required>
        @for (property of schema.properties | keyvalue; track property) {
          <mat-option [value]="property.key">{{ property.key }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field>
      <mat-label>operator</mat-label>
      <mat-select [formControl]="filter.controls.operator" required>
        <mat-option [value]="'equals'">=</mat-option>
        <mat-option [value]="'lte'">&lt;</mat-option>
        <mat-option [value]="'gte'">&gt;</mat-option>
      </mat-select>
    </mat-form-field>

    @if (filter.controls.field.value) {
      <mat-form-field>
        <mat-label>value</mat-label>
        <input matInput [type]="filter.controls.type.value" [formControl]="filter.controls.value" required />
      </mat-form-field>
    }
    <button mat-fab color="warn" (click)="removeFilter(idx)">
      <mat-icon>remove</mat-icon>
    </button>
  </div>
</ng-container>

<button mat-flat-button color="primary" (click)="triggerSearch()" [disabled]="filters.invalid">serach</button>
